#!/bin/bash
clear

# Переменные для тестирования
MEMSIZE=$((256 * 16)) # Размер буфера (16 записей по 16 байт)
NUM_RECORDS=256        # Количество записей
BLOCKS=4              # Количество блоков
THREADS=2             # Количество потоков
FILENAME="test_index.dat"

# Проверка, что все исполняемые файлы существуют
if [[ ! -x ./gen || ! -x ./view || ! -x ./sort_index ]]; then
  echo "Ошибка: Убедитесь, что программы gen, view и sort_index скомпилированы и доступны."
  exit 1
fi

# Шаг 1: Генерация файла
echo "Генерация файла..."
./gen "$FILENAME" "$NUM_RECORDS"
if [[ $? -ne 0 ]]; then
  echo "Ошибка при выполнении генерации файла."
  exit 1
fi

# Шаг 2: Показать содержимое файла (до сортировки)
echo "Содержимое файла (до сортировки):"
./view "$FILENAME"
if [[ $? -ne 0 ]]; then
  echo "Ошибка при отображении содержимого файла."
  exit 1
fi

# Шаг 3: Сортировка файла
echo "Сортировка файла..."
./sort_index "$MEMSIZE" "$BLOCKS" "$THREADS" "$FILENAME"
if [[ $? -ne 0 ]]; then
  echo "Ошибка при выполнении сортировки."
  exit 1
fi

# Шаг 4: Показать содержимое файла (после сортировки)
echo "Содержимое файла (после сортировки):"
./view "$FILENAME"
if [[ $? -ne 0 ]]; then
  echo "Ошибка при отображении содержимого файла после сортировки."
  exit 1
fi

echo "Тестирование завершено успешно."
exit 0
